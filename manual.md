# 社内ISUCON マニュアル

## 当日の流れ

  * 10:00 競技開始
  * 18:00 競技終了

ただし、15:00 - 15:30 は一時中断

## ポータルサイト

TODO:

上記リンクを開いてください。計測ツールで測定したスコアはこのポータルに送られ、集計結果を見ることができます。

## Getting Started

はじめに以下の操作を行い、問題なく動くかを確認して下さい。

### 2. 起動したVPSに `root` ユーザで パスワードログインする

例:

```
ssh root@xx.xx.xx.xx
```

ログイン後に`isucon`ユーザーでログインできるようにすることをおすすめします。

### 3. アプリケーションの動作を確認

VPSのパブリックIPアドレスにブラウザでアクセスし、動作を確認してください。以下の画面が表示されるはずです。

例として、「アカウント名」は `kfly8`、 「パスワード」は `kfly8` を入力することでログインが行えます。

ブラウザでアクセスできない場合、主催者に確認してください。

### 4. 負荷走行を実行

この操作後、ポータルにて、あなたのチームのスコアが反映されているか確認して下さい。

### ディレクトリ構成

参考実装のアプリケーションコードおよび、スコア計測用プログラムは `/home/isucon` ディレクトリ以下にあります。

```
/home/isucon/
  ├ env.sh       # アプリケーション用の環境変数
  └ private_isu/
     ├ webapp/    # 各言語の参考実装
     ├ db/        # アプリケーションのスキーマや初期データ
     ├ client/      # アプリケーションの共通のクライアント
     ├ manual.md    # 本マニュアル
     └ public_manual.md # 当日レギュレーション
```

### 参考実装の言語切り替え方法

参考実装の言語はPerl, Golangが用意されており、初期状態ではPerlの実装が起動しています。

80番ポートでアクセスできるので、ブラウザから動作確認をすることができます。

プログラムの詳しい起動方法は、 /etc/systemd/system/isu-perl.service を参照してください。

また、アプリーケーションサーバの再起動は、

```
$ sudo systemctl restart isu-perl
```

などですることができます。

#### Goへの切り替え方

起動する実装をGOに切り替えるには、以下の操作を行います。

```
$ sudo systemctl stop isu-perl
$ sudo systemctl start isu-go
```

プログラムの詳しい起動方法は、 /etc/systemd/system/isu-go.service を参照してください。

### MySQL

3306番ポートでMySQLが起動しています。初期状態では以下のユーザが設定されています。

  * ユーザ名: `root`, パスワードなし

## ルール詳細

なお、当日レギュレーションと本マニュアルの記述に矛盾がある場合、本マニュアルの記述が優先されます。

### スコアについて

基本スコアは以下のルールで算出されます。

```
成功レスポンス数(GET) x 1 + 成功レスポンス数(POST) x 2 - (サーバエラー(error)レスポンス数 x 10 + リクエスト失敗(exception)数 x 20)
```

ただし、基本スコアと計測ツールの出すスコアが異なっている場合は、計測ツールの出すスコアが優先されます。

#### 減点対象

以下の事項に抵触すると減点対象となります。

  * リクエスト失敗（通信エラー等）が発生する
  * サーバエラー(Status 5xx)・クライアントエラー(Status 4xx)をアプリケーションが返す
  * 他、計測ツールのチェッカが検出したケース

#### 注意事項

  * POSTの失敗は大幅な減点対象です
  * ベンチマークされていない内容は採点対象外です

### 制約事項

以下の事項に抵触すると点数が無効となります。

  * GET /initialize へのレスポンスが10秒以内に終わらない
  * APIレスポンスの構造が変化していた

## 当日サポートについて

競技中、アナウンス済みのSlackのチャンネルにて、サポートを行います。

ルールについてや、基本的なトラブルの質問にはお答えできますが、計測ツールおよびアプリケーションに関する質問には原則として回答しません。予めご了承ください。
